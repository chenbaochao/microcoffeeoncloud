version: '3'
services:
    gateway:
        image: microcoffeeoncloud-gateway:1.0.0-SNAPSHOT
        ports:
            - "8080:8080"
            - "8443:8443"
        environment:
            - SPRING_PROFILES_ACTIVE=devdocker
            - SPRING_CLOUD_CONFIG_URI=https://192.168.99.100:8454
        domainname: microcoffee.study
    web:
        image: microcoffeeoncloud-web:1.0.0-SNAPSHOT
        ports:
            - "8090:8090"
            - "8453:8453"
        links:
            - location
            - order
        environment:
            - SPRING_PROFILES_ACTIVE=devdocker
            - SPRING_CLOUD_CONFIG_URI=https://192.168.99.100:8454
        domainname: microcoffee.study
    location:
        image: microcoffeeoncloud-location:1.0.0-SNAPSHOT
        ports:
            - "8081:8081"
            - "8444:8444"
        links:
            - mongodb
        environment:
            - SPRING_PROFILES_ACTIVE=devdocker
            - SPRING_CLOUD_CONFIG_URI=https://192.168.99.100:8454
        domainname: microcoffee.study
    order:
        image: microcoffeeoncloud-order:1.0.0-SNAPSHOT
        ports:
            - "8082:8082"
            - "8445:8445"
        links:
            - mongodb
        environment:
            - SPRING_PROFILES_ACTIVE=devdocker
            - SPRING_CLOUD_CONFIG_URI=https://192.168.99.100:8454
        domainname: microcoffee.study
    creditrating:
        image: microcoffeeoncloud-creditrating:1.0.0-SNAPSHOT
        ports:
            - "8083:8083"
            - "8446:8446"
        environment:
            - SPRING_PROFILES_ACTIVE=devdocker
            - SPRING_CLOUD_CONFIG_URI=https://192.168.99.100:8454
        domainname: microcoffee.study
    mongodb:
        image: microcoffeeoncloud-database:1.0.0-SNAPSHOT
        command: mongod --sslMode preferSSL --sslPEMKeyFile /microcoffee.study-key.pem --bind_ip_all
        ports:
            - "27017:27017"
            - "28017:28017"
        domainname: microcoffee.study
        volumes:
            - mongodbdata:/data/db
volumes:
    mongodbdata:
        external: true
